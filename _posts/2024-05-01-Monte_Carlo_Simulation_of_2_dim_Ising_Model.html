---
date    : 2024-05-01

title   : "Monte-Carlo Simulation of 2-dim Ising Model"
excerpt : "Power of numerical simulation"

writer  : Junyeop Kim
use_math: true

categories:
  - 'Computational Physics'

comments: true

published : true
---

<head>
    <style>
        .center {
            text-align: justify;
        }

        .MathJax, .MathJax_Display, .MJXc-display, .MathJax_SVG_Display, .math {
            display: block;
            overflow-x: auto;
            overflow-y: hidden;
            max-width: 100%;
            min-width: 0 ! important
        }
        .img {
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        .container {
          text-align: center;
        }
    </style>

    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
</head>



<body>

<p> 
  &nbsp; <br/> 
  If you had studied quantum statistical physics, then you must be familiar to the spontatneous magnetisation which is representative by Ising model, 
  the most typical example of second order phase transition. <br/>

  Even though the way to solve the 2-dim Ising model exactly is well-known (Majorana fermionic operator + Wigner-Jordan transform, or C.N. Yang's paper), 
  it demands solid backgrounds in quantum field theory or operational analysis to understand.
  Hence, we've taught the spontaneous magnetisation mostly via Landau's Mean Field Approach in undergraduate level statistical physics course. <br/>

  However, we can derive the tendancy of this phase transition in approximate level 
  from a combination of numerical methods of which names are Monte-Carlo simulation and Metropolis algorithm. <br/>

  In this post, I'm gonna adumbrate basic concept of Monte-Carlo simulation and explain the codes that I wrote using Fortran90 and Python line by line. <br/><br/>
</p>

<h2 class="unnumbered">
  0. Theoretical Set-Up
</h2>
<p>
  &nbsp; <br/> 
  ARRRRRRRRR
  <br/><br/>
</p> 


<h2 class="unnumbered">
  1. Evolutions of spin-configuration and magnetisation w.r.t. iteration
</h2>
<p>
  Firstly, I wrote a Fortran code that shows how spin configuration and magnetisation 
  of the system vary as the Monte-Carlo time-step. I used Fortran 90 for the main program and Python for visualisations. <br/><br/>
</p>
<h3 class="unnembered">
  1.1 Main Program (Fortran 90)
</h3>
<p>
  &nbsp; <br/> 
  Let us begin with "PROGRAM ~" as usual.
  <code>
    PROGRAM ISING_MODEL
  </code> <br/> <br/>

  Let us declare variables. For the place marked by question marks, just put any values as you want.
  <code>
    !---DECLARE VARIABLES---------------------------

    IMPLICIT NONE


    INTEGER(4) :: I_ROW, I_COL 
    INTEGER(4) :: SPIN_LOW, SPIN_COL
    INTEGER(4) :: ITR
    iNTEGER(4) :: PRE_MAGNETISATION

    INTEGER, PARAMETER :: DIM_ROW = ???, DIM_COL = ???
    INTEGER, PARAMETER :: NUMBER_TOTAL_SPIN = DIM_ROW * DIM_COL
    INTEGER, PARAMETER :: ITERATION = ???

    INTEGER, DIMENSION(DIM_ROW , DIM_COL) :: SPIN_CONFIG


    DOUBLE PRECISION, DIMENSION(ITERATION + 1) :: NORMALISED_MAGNETISATION

    DOUBLE PRECISION, PARAMETER :: J = ???                  ! SPIN CORRELATION
    DOUBLE PRECISION, PARAMETER :: GAMMA = 4.               ! NUMBER OF NEAREST LATTICE SITES (assume square lattice)
    DOUBLE PRECISION, PARAMETER :: BETA_C = 1/(J*GAMMA)     ! CRITICAL TEMPERATURE OF MEAN FIELD THEORY
    DOUBLE PRECISION, PARAMETER :: BETA_RATIO = ???         ! BETA_RATIO = BETA / BETA_C ... THEN BETA = BETA_C * BETA_RATIO

    DOUBLE PRECISION :: DEL_ENERGY, E_I, E_F
    DOUBLE PRECISION :: RND, RND_ROW, RND_COL


    !--- DIRECTORY RELATED VARIABLES
    
    CHARACTER(100) FOLDER_NAME

    INTEGER :: FU
    CHARACTER(100) FILE_NAME
    CHARACTER(100) FILE_ID
    
    INTEGER :: IERR, UNIT_NUM, IOSTAT


    !--- VARIABLES FOR THE PROGRAM EXECUATION TIME
    REAL :: START_TIME, END_TIME, TOT_TIME
  </code> <br/> <br/>

  Let's call the cpu time to estimate the execuation time, cuz im curious kkk.
  <code>
    !---LOAD CPU_TIME TO EVALUATE THE EXECUATION TIME---------------------------------
    
    CALL CPU_TIME(START_TIME)

    !---------------------------------------------------
  </code> <br/> <br/>

  Let us set up the initial spin configuration. <br/> <br/>
  We are gonna consider only two cases for the initial configurations, <br/>
    i) high temperature limit (completely random configuration)
    ii) 0 temperature limit (completely ordered configuration)
  <code>
     !---HIGH TEMPERATURE LIMIT ---------------------
    
      DO I_COL = 1, DIM_COL, +1

          DO I_ROW = 1, DIM_ROW, +1

              !---CHOOSE A REAL VALUE IN (0,1) RANGE
              CALL RANDOM_NUMBER(RND)

              !---COMPARE RND W/ 0.5
              !---IF RND < 0.5, GIVE UP-SPIN. ELSE, GIVE DOWN=SPIN
              IF ( RND < 0.50000000000000 ) THEN
                  SPIN_CONFIG(I_ROW, I_COL) = -1
              ELSE   
                  SPIN_CONFIG(I_ROW, I_COL) = +1
              END IF

          END DO
    
      END DO

    


      !---LOW TEMPERATURE LIMIT

      !DO I_COL = 1, DIM_COL, +1
      !    DO I_ROW = 1, DIM_ROW, +1
      !        SPIN_CONFIG(I_ROW, I_COL) = +1
      !    END DO
      !END DO
  </code> <br/><br/>

  Let us calculate the normalised magnetisation of the initial spin configuration.

  <code>
    !---CALCULATE THE MAGNETISATION OF INITIAL STATE-------------------------------
    
    ITR = 0

    PRE_MAGNETISATION = 0
    
    DO I_COL = 1, DIM_COL, +1
        
        DO I_ROW = 1, DIM_ROW, +1
        
            PRE_MAGNETISATION = PRE_MAGNETISATION + SPIN_CONFIG(I_ROW, I_COL)
        
        END DO
    
    END DO
    
    NORMALISED_MAGNETISATION(ITR) = 1. * PRE_MAGNETISATION / NUMBER_TOTAL_SPIN 
    !--- I PUT (1.*) TERM TO PREVENT FROME THE MAGNETISATION BECOMING INTEGER...!
  </code> <br/><br/>

  사실 코드를 처음부터 python이나 julia로 작성했으면, spin configuration의 data를 
  바로 이미지로 변환해서 이미지 자체를 list에 차곡차곡 하나씩 쌓을 수 있기 때문에, 
  후술할 과정은 다른 언어라면 불필요한 과정일 수 있겠으나... 
  (우리의 Fortran은 그런 packages 없기 때문에...) <br/><br/>
 
  앞으로 DO loop를 돌리면서 얻게 될 each iteration step(?)에서의 spin configuration을 txt format으로 저장하려고 한다.
  이 spin configuration txt 파일들을 새로운 하위폴더를 만들어서 저장을 할 생각인데, 아래에 적어둔 code가 해당 역할을 수행한다.
  <code>
     !--- WRITE THE SPIN CONFIGURATION AS A TXT FILE, and MAGNETISATION DATA IN A NEW FOLDER

      ! Specify the folder name you want to create

        ! Write the integer into a string:
        FU = ITR + 20 !왜냐면 unit은 10부터 출발하자나...!!
    
        FOLDER_NAME = "spin_config"

      ! Use a system-specific command to create the folder
      ! Replace the following line with the appropriate command for your system (e.g., mkdir on Unix-like systems)
      ! On Windows, you can use "mkdir" as well.
        CALL SYSTEM("mkdir " // TRIM(FOLDER_NAME), IERR)

        IF (IERR == 0) THEN

        ! Specify the name of the text file to create inside the folder
            WRITE(FILE_ID, '(I0)') ITR
            FILE_NAME = TRIM(FOLDER_NAME) // "/config" // TRIM(ADJUSTL(FILE_ID)) // ".txt"
        
        ! Open the text file for writing
            OPEN( UNIT = FU , FILE = TRIM(FILE_NAME) , STATUS = "replace", ACTION = "write", IOSTAT = IOSTAT )

            IF (IOSTAT == 0) THEN
          ! Write data to the file
                WRITE(FU, *) SPIN_CONFIG
          ! Close the file
                CLOSE(FU)
            END IF

        END IF


        OPEN( 10, FILE = "magnetisation.txt", STATUS = "new" )    
        WRITE(10 ,*) ITR, NORMALISED_MAGNETISATION(ITR)
  </code> <br/>
  마지막 두 줄은 magnetisation을 기록하기 위한 새로운 txt file을 만들고, 파일을 열어서 데이터를 입력하도록 하는 코드이다. 
                이 파일은 그냥 main Fortran code와 동일한 directory에 저장할 생각이다.


                
  <br/><br/>
</p> 
<h3 class="unnembered">
  1.2 Visualisation (Python)
</h3>
<p>
  &nbsp; <br/> 
  ARRRRRRRRR
  <br/><br/>
</p> 


<h2 class="unnumbered" id="motivation">
  2. Magnetisation w.r.t. Temperature
</h2>
<h3 class="unnembered">
  1.1 Main Program (Fortran 90)
</h3>
<p>
  &nbsp; <br/> 
  ARRRRRRRRR
  <br/><br/>
</p> 
<h3 class="unnembered">
  1.2 Visualisation (Python)
</h3>
<p>
  &nbsp; <br/> 
  ARRRRRRRRR
  <br/><br/>
</p> 

